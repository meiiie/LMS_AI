======================================================================
P3 SOTA STREAMING VERIFICATION
Date: 2025-12-21 03:03:24
Target: https://maritime-ai-chatbot.onrender.com
======================================================================

âš ï¸  Using SAME test questions as test_production_api.py for fair comparison
âš ï¸  Answer length comparison excludes <thinking> block content
======================================================================
P3 SOTA STREAMING TEST - /api/v1/chat/stream/v2
======================================================================

======================================================================
TEST 1/1: Äiá»u 50 - Quyá»n háº¡n thuyá»n trÆ°á»Ÿng (same as production_api.py)
======================================================================

ğŸ“¤ Request: Giáº£i thÃ­ch Äiá»u 50 vá» quyá»n háº¡n cá»§a thuyá»n trÆ°á»Ÿng trÃªn tÃ u biá»ƒn theo Bá»™ luáº­t hÃ ng háº£i Viá»‡t Nam 2015.
----------------------------------------------------------------------
Status: 200
Content-Type: text/event-stream; charset=utf-8
----------------------------------------------------------------------

ğŸ“¨ Events received:

   ğŸ”„ thinking: {"content": "ğŸ¯ Äang phÃ¢n tÃ­ch cÃ¢u há»i..."}...
   ğŸ”„ thinking: {"content": "ğŸ” Äang tra cá»©u cÆ¡ sá»Ÿ dá»¯ liá»‡u..."}...
   ğŸ”„ thinking: {"content": "ğŸ“š TÃ¬m tháº¥y 10 tÃ i liá»‡u liÃªn quan"}...
   ğŸ”„ thinking: {"content": "âœï¸ Äang táº¡o cÃ¢u tráº£ lá»i..."}...

   âš¡ FIRST TOKEN TIME: 33.11s
----------------------------------------------------------------------
   ğŸ“ token #1: {"content": "<thinking>\nNgÆ°á»i dÃ¹ng muá»‘n giáº£i thÃ­ch vá» **Äiá»u 50** cá»§a Bá»™ luáº­t HÃ ng háº£i Viá»‡t Nam 2015 liÃªn quan Ä‘áº¿n"}...
   ğŸ“ token #2: {"content": " quyá»n háº¡n cá»§a thuyá»n trÆ°á»Ÿng.\nDá»±a trÃªn kiáº¿n thá»©c tra cá»©u (RAG):\n- **Äiá»u 50"}...
   ğŸ“ token #3: {"content": "** quy Ä‘á»‹nh vá» **Thuyá»n bá»™**: XÃ¡c Ä‘á»‹nh thuyá»n bá»™ gá»“m thuyá»n trÆ°á»Ÿng, sÄ© quan vÃ  cÃ¡c chá»©c danh khÃ¡c. Th"}...
   ğŸ“ ... (streaming 4+ tokens)
   ğŸ“š sources: 10 sources received
   ğŸ“Š metadata: processing_time=37.391s, model=maritime-rag-v1
   âœ… done

======================================================================
TEST RESULTS
======================================================================
   Question:        Giáº£i thÃ­ch Äiá»u 50 vá» quyá»n háº¡n cá»§a thuyá»n trÆ°á»Ÿng trÃªn tÃ u b...
   Total tokens:    34
   Raw answer:      3233 chars
   Clean answer:    2175 chars (excluding <thinking>)
   Thinking length: 1033 chars
   Thinking events: 4
   First token:     33.11s
   Total time:      38.02s
   Processing time: 37.391s
   Sources:         10
   Error:           None

   ğŸ§  THINKING CONTENT PREVIEW (first 300 chars):
----------------------------------------------------------------------
   NgÆ°á»i dÃ¹ng muá»‘n giáº£i thÃ­ch vá» **Äiá»u 50** cá»§a Bá»™ luáº­t HÃ ng háº£i Viá»‡t Nam 2015 liÃªn quan Ä‘áº¿n quyá»n háº¡n cá»§a thuyá»n trÆ°á»Ÿng.
   Dá»±a trÃªn kiáº¿n thá»©c tra cá»©u (RAG):
   - **Äiá»u 50** quy Ä‘á»‹nh vá» **Thuyá»n bá»™**: XÃ¡c Ä‘á»‹nh thuyá»n bá»™ gá»“m thuyá»n trÆ°á»Ÿng, sÄ© quan vÃ  cÃ¡c chá»©c danh khÃ¡c. Thuyá»n trÆ°á»Ÿng lÃ  ngÆ°á»i Ä‘á»©ng Ä‘áº§u thuy
   ... (733 more chars)

   ğŸ“ CLEAN ANSWER PREVIEW (first 500 chars):
----------------------------------------------------------------------
   **Äiá»u 50** cá»§a Bá»™ luáº­t hÃ ng háº£i Viá»‡t Nam 2015 lÃ  "Ä‘iá»ƒm neo" Ä‘áº§u tiÃªn xÃ¡c Ä‘á»‹nh vá»‹ tháº¿ cá»§a ngÆ°á»i chá»‰ huy trÃªn má»™t con tÃ u biá»ƒn. Thay vÃ¬ liá»‡t kÃª chi tiáº¿t tá»«ng quyá»n háº¡n cá»¥ thá»ƒ, Ä‘iá»u nÃ y táº­p trung vÃ o viá»‡c Ä‘á»‹nh nghÄ©a **Thuyá»n bá»™** vÃ  kháº³ng Ä‘á»‹nh vai trÃ² trung tÃ¢m cá»§a **Thuyá»n trÆ°á»Ÿng**.
   
   Theo quy Ä‘á»‹nh nÃ y, **Thuyá»n trÆ°á»Ÿng** khÃ´ng chá»‰ lÃ  má»™t chá»©c danh lÃ m viá»‡c mÃ  lÃ  ngÆ°á»i Ä‘á»©ng Ä‘áº§u thuyá»n bá»™, cÃ³ quyá»n chá»‰ huy cao nháº¥t Ä‘á»‘i vá»›i táº¥t cáº£ má»i ngÆ°á»i trÃªn tÃ u, tá»« cÃ¡c sÄ© quan dÃ y dáº¡n kinh nghiá»‡m Ä‘áº¿n nhá»¯ng thá»§y 
   ... (1675 more chars)




======================================================================
V1 (production /chat) vs V2 (streaming) COMPARISON
======================================================================

ğŸ“¡ Testing V1 (/api/v1/chat - non-streaming, full CRAG pipeline)...
   âœ… V1 Success: 3627 chars, 5 sources in 57.36s

ğŸ“¡ Testing V2 (/api/v1/chat/stream/v2 - true streaming)...
   âœ… V2 Success: 2652 chars (clean), 10 sources
      First token: 17.00s, Total: 21.32s

======================================================================
COMPARISON RESULTS
======================================================================
| Metric          | V1 (/chat)      | V2 (/stream/v2)   | Improvement    |
|-----------------|-----------------|-------------------|----------------|
| First visible   | 57.36s (all)    | 17.00s (token)   | 3.4x faster    |
| Total time      | 57.36s          | 21.32s             | -              |
| Answer (clean)  |  3627 chars    |  2652 chars       | Different      |
| Sources         |     5           |    10             | Different      |

--- V1 Answer Preview (first 300 chars) ---
   Dá»±a trÃªn ná»™i dung tá»« cÃ¡c há»‡ thá»‘ng há»— trá»£, dÆ°á»›i Ä‘Ã¢y lÃ  báº£n tá»•ng há»£p giáº£i thÃ­ch chi tiáº¿t vÃ  máº¡ch láº¡c vá» **Äiá»u 50 Bá»™ luáº­t HÃ ng háº£i Viá»‡t Nam 2015** liÃªn quan Ä‘áº¿n quyá»n háº¡n cá»§a thuyá»n trÆ°á»Ÿng:
   
   ---
   
   ### Giáº£i thÃ­ch Äiá»u 50: Quyá»n háº¡n cá»§a Thuyá»n trÆ°á»Ÿng trÃªn tÃ u biá»ƒn

--- V2 Answer Preview (first 300 chars, cleaned) ---
   **Äiá»u 50** cá»§a Bá»™ luáº­t HÃ ng háº£i Viá»‡t Nam 2015 thá»±c cháº¥t lÃ  "báº£n danh sÃ¡ch" Ä‘á»‹nh nghÄ©a vá» **Thuyá»n bá»™** â€“ nhá»¯ng ngÆ°á»i cÃ¹ng sinh tá»­ cÃ³ nhau trÃªn má»™t con tÃ u. 
   
   Dá»±a trÃªn ná»™i dung nÃ y vÃ  cÃ¡c quy Ä‘á»‹nh liÃªn quan, tÃ´i xin chia sáº» vá»›i báº¡n nhÆ° sau:
   
   TrÆ°á»›c háº¿t, báº¡n cáº§n lÆ°u Ã½ ráº±ng **Äiá»u 50** xÃ¡c láº­p vá»‹ trÃ­ c

======================================================================
FINAL SUMMARY
======================================================================
   Tests passed:       1/1
   Avg first token:    33.11s (target: <40s)
   Avg clean answer:   2175 chars
   Latency improvement: 3.4x faster first token

âœ… ALL TESTS PASSED - P3 STREAMING WORKING!

======================================================================